# How to compute planetary positions

By Paul Schlyter, Stockholm, Sweden

[原文](http://www.stjarnhimlen.se/comp/ppcomp.html)

## 精度について

+ 章動および収差については考慮されていません
+ 惑星の収差（光行差等）については考慮されていません
+ 地球時/暦表示と世界標準時の差については考慮されていません
+ 歳差については黄経をもとに単純化した計算式を使用しています
+ 軌道要素の高次の項は考慮していませんが、現在より1000年以内であれば惑星で2分、付きで7分未満の誤差に収まっています。
+ 月、木星、土星、天王星以外の天体について摂動は考慮されていません。
+ 天王星および冥王星は摂動の影響を最も受ける惑星のため（特に未来において）誤差が大きくなります。数世紀以内ならたぶんそんなに大きな誤差ではないです。

## 時間単位

2000/1/1 00:00 UT からの日数をもとに計算をします。

+ y = 年
+ M = 月
+ D = 日
+ UT = 時間

$d = 367 \times y - 7 \times (y + (m + 9) \div 12) \div 4 + 275 \times m \div 9 + D - 730530$

上式は1900年3月～2100年2月でのみ正確な値になります。
グレゴリオ暦内全てで使用する場合は以下の式を使用してください。

$d = 367 \times y - 7 \times ( y + (m + 9) \div 12) \div 4 - 3 \times ((y + (m - 9) \div 7) \div 100 + 1) \div 4 + 275 \times m \div 9 + D - 730515$

$d = d + UT \div 24.0$

## 軌道要素

### 主要な軌道要素

+ $N = 昇交点経度$
+ $i = 黄道傾斜角$
+ $w = 近点引数$
+ $a = 軌道長半径$
+ $e = 離心率$
+ $M = 平均近点角$

### 関連する軌道要素

+ $w1 = N + w = 近日点経度$
+ $L = M + w1 = 平均経度$
+ $q = a \times (1 - e) = 近点距離$
+ $Q = a \times (1 + e) = 遠点距離$
+ $P = a^{1.5} = 軌道周期$
+ $T = Epoch\_of\_M - (M[deg] \div 360) \div P = 近日点時刻$
+ $v = 真近点角 = 近点角と座標のなす角度$
+ $E = 離心近点角$

Astronomical Unit (AU) は地球と太陽の平均距離を表す単位で、およそ149,600,000kmです。惑星が最も太陽に近づく位置を「近日点」、最も遠ざかる位置を「遠日点」と呼びます。月や人工衛星など、地球を基準にした軌道の場合は「近地点」「遠地点」と呼びます。

平均近点角
: 時間に比例して増加する角度（0°～360°）。近日点で0度。軌道周期を最近の近日点時刻で割って算出できる。

真近点角
: 太陽から見た惑星の座標と近日点とのなす角度。時間に比例せず、近点角で最も増加率が大きくなる。

離心近点角
: ケプラー方程式に使用する補助的な角度。平均近点角と離心率から真近点角を算出するときに使う。

軌道上の座標を表現するためには、「平均近点角」「真近点角」「離心近点角」の3つの角度を使用します。

また、黄道座標系を赤道座標系に変換する場合は黄道傾斜角（黄道と赤道のなす角度）を算出する必要があります。

黄道傾斜角
: $ecl = 23.4393 - 3.563E-7 \times d$

**※ 軌道長半径は月の場合地球からの距離になります。その他の惑星は太陽からの距離（天文単位）です。**

**※ 平均近点角（月の場合昇交点経度と近点引数）を算出した時に360°を超える値や、負の値になる場合があります。負の値になった場合は360°を加算、360°を超える場合は360で割った余りに変換してください。**

**※ 多くのプログラミング言語では角度の計算に radius を使用するので角度に　π/180 を乗じる必要があります。**

## 各天体の軌道要素

### 太陽

+ $N = 0.0$
+ $i = 0.0$
+ $w = 282.9404 + 4.70935E-5 \times d$
+ $a = 1.000000  (AU)$
+ $e = 0.016709 - 1.151E-9 \times d$
+ $M = 356.0470 + 0.9856002585 \times d$

### 月

+ $N = 125.1228 - 0.0529538083 \times d$
+ $i = 5.1454$
+ $w = 318.0634 + 0.1643573223 \times d$
+ $a = 60.2666  (地球の半径の倍数)$
+ $e = 0.054900$
+ $M = 115.3654 + 13.0649929509 \times d$

### 水星

+ $N =  48.3313 + 3.24587E-5 \times d$
+ $i = 7.0047 + 5.00E-8 \times d$
+ $w =  29.1241 + 1.01444E-5 \times d$
+ $a = 0.387098  (AU)$
+ $e = 0.205635 + 5.59E-10 \times d$
+ $M = 168.6562 + 4.0923344368 \times d$

### 金星

+ $N =  76.6799 + 2.46590E-5 \times d$
+ $i = 3.3946 + 2.75E-8 \times d$
+ $w =  54.8910 + 1.38374E-5 \times d$
+ $a = 0.723330  (AU)$
+ $e = 0.006773 - 1.302E-9 \times d$
+ $M =  48.0052 + 1.6021302244 \times d$

### 火星

+ $N =  49.5574 + 2.11081E-5 \times d$
+ $i = 1.8497 - 1.78E-8 \times d$
+ $w = 286.5016 + 2.92961E-5 \times d$
+ $a = 1.523688  (AU)$
+ $e = 0.093405 + 2.516E-9 \times d$
+ $M =  18.6021 + 0.5240207766 \times d$

### 木星

+ $N = 100.4542 + 2.76854E-5 \times d$
+ $i = 1.3030 - 1.557E-7 \times d$
+ $w = 273.8777 + 1.64505E-5 \times d$
+ $a = 5.20256  (AU)$
+ $e = 0.048498 + 4.469E-9 \times d$
+ $M =  19.8950 + 0.0830853001 \times d$

### 土星

+ $N = 113.6634 + 2.38980E-5 \times d$
+ $i = 2.4886 - 1.081E-7 \times d$
+ $w = 339.3939 + 2.97661E-5 \times d$
+ $a = 9.55475  (AU)$
+ $e = 0.055546 - 9.499E-9 \times d$
+ $M = 316.9670 + 0.0334442282 \times d$

### 天王星

+ $N =  74.0005 + 1.3978E-5 \times d$
+ $i = 0.7733 + 1.9E-8 \times d$
+ $w =  96.6612 + 3.0565E-5 \times d$
+ $a = 19.18171 - 1.55E-8 \times d  (AU)$
+ $e = 0.047318 + 7.45E-9 \times d$
+ $M = 142.5905 + 0.011725806 \times d$

### 海王星

+ $N = 131.7806 + 3.0173E-5 \times d$
+ $i = 1.7700 - 2.55E-7 \times d$
+ $w = 272.8461 - 6.027E-6 \times d$
+ $a = 30.05826 + 3.313E-8 \times d  (AU)$
+ $e = 0.008606 + 2.15E-9 \times d$
+ $M = 260.2471 + 0.005995147 \times d$

**※ ここで与えられる天王星と冥王星の軌道要素の精度は他の天体より低いものになります。これらの天体は約4200年周期の摂動がありますが、数世紀以内なら精度に問題は出ないかと思います。**

## 太陽の座標

太陽の座標も他の惑星と同じように計算します。ただし、太陽は常に行動面上にあり、軌道の離心率が小さいため多少単純化できます。

地球は太陽を中心に回っていますが、太陽を地球の中心に回る衛星として計算します。

まず、平均近点角から離心近点角を求めます。

### E および M が度数法の値の場合（単位が°）

$E = M + e \times (180 \div π) \times sin(M) * (1.0 + e \times cos(M))$
　　
### E および M が弧度法の場合

$E = M + e \times sin(M) \times (1.0 + e \times cos(M))$

（上式は正確ではないが、ここでは十分小さい誤差になる）
次に、太陽までの距離 r と真近点角 v を算出する

$xv = r \times cos(v) = cos(E) - e$  
$xy = r \times sin(v) = \sqrt{1.0 - e^2} \times sin(E)$

$v = tan^{-1}(yv / xv)$  
$r = \sqrt{xv^2 + yv^2}$

**※ $tan^{-1}$は-90°～90°の値になるため、実際の角度と象限が違って算出される場合があるので、象限を補正する必要があります。プログラミングする場合は atan2(y, x) を利用すると自動的に象限を補正してくれます。**

太陽の黄経を求める

$lonsun = v + w$

極座標系から直交座標系に変換

$xs = r \times cos(lonsun)$  
$ys = r \times sin(lonsun)$

（太陽は必ず黄道面上にあるので zs は０になる）  
xs および ys は黄道の直交座標系の値なので、赤道座標系に変換する。

$xe = xs$  
$ye = ys \times cos(ecl)$  
$ze = ys \times sin(ecl)$

赤経と赤緯に変換する

$RA = tan^{-1}(ye/xe)$  
$Dec = tan^{-1}(ze/\sqrt{xe^2 + ye^2}$

## 恒星時 (Sidereal Time : LS)

天体の計算において、恒星時の算出はよく出てきます。地方恒星時は所在地の子午線の赤経に当たります。  
グリニッジ平均恒星時 (Grennwich Mean Sideral Time: GMST) はグリニッジにおける地方恒星時と言えます。  
地方恒星時は、世界標準時の深夜0時におけるグリニッジ平均恒星時 (GMST0)から求めます。  
このアルゴリズムではGMST0の概念を少し拡張した独自のGMST0をします。  
GTMST0 は24時間ごとに 3'51" 増加します

$GMST = GMST0 + UT$

また、太陽の平均近点角と近点引数から太陽の平均経度 Ls を求める必要があります。

$Ls = M + w$

GMST0 は太陽の平均経度から簡単に求めることができます。GMST はGMST0 に世界票人事を加えることで、地方恒星時はそこに所在地の経度を足すことで求めることができます。

$GMST0 = Ls + 180 degree$
$GMST = GMST0 + UT$
$LST = GMST + 経度 \div 15$

## 月および惑星の座標

まず、ケプラーの方程式を解く必要があります

$M = e \times sin(E) - E$

平均近点角 M と離心率 e は与えられているので、離心近点角 E を求めることができます。  

平均近点角 M および離心近点角 E を度数法で扱う場合
: $E = M + e \times sin(M) \times (1.0 + e * cos(M))$

平均近点角 M および 離心近点角 E を弧度法で扱う場合
: $E = M \times (180 \div π) \times sin(M) \times (1.0 + e \times cos(M)$

離心率 e が0.05-0.06未満の場合は、上記の近似式で十分な精度になります。もし、離心率 e がそれよりも大きい場合は、初期値 E0 = E として、値の増加が十分小さく(1E-4 か 1E-5)なるまで以下の計算を繰り返して離心近点角 E を求めます。

平均近点角 M および離心近点角 E を度数法で扱う場合
: $E1 = E0 - (E0 - e \times(180 \div π) \times sin(E0) - M) \div (1 - e \times cos(E0))$

平均近点角 M および 離心近点角 E を弧度法で扱う場合
: $E1 = E0 - (E0 - e \times sin(E0 - M) \div (1 - e \times cos(E0))$

※ただし、上式は離心率が1に近い場合には収束しません。その場合は放物線軌道の式を用いる必要があります。

最後に、求めた値を用いて座標を計算します。

$xv = r \times cos(v) = a \times (cos(E) - e)$  
$yv = r \times sin(v) = a \times (\sqrt{1.0 - e^2} \times sin(E))$

$v = tan^{-1}(yv/xv)$  
$r = \sqrt{xv^2 + yv^2}$

## 宇宙での座標

惑星の3次元座標を算出します

$xh = r \times (cos(N) \times cos(v+w) - sin(N) \times sin(v+w) \times cos(i))$  
$yh = r \times (sin(N) \times cos(v+w) + cos(N) \times sin(v+w) \times cos(i))$  
$zh = r \times (sin(v+w) \times sin(i))$

月の場合は、地心黄道座標系になります。惑星の場合は日心座黄経標系です。  
上記が求まれば黄経と黄緯を求めることができます。

$lonecl = tan^{-1}(yh/xh)$
$latecl = tan^{-1}(zh/\sqrt{xh^2 yh^2})$

## 歳差

もし、1950年や2000年などの基準元期における天体の位置を計算したい場合（例えば星図上にプロットするとか）、黄経の補正が必要になります。  
惑星（月以外）の位置を算出する場合は太陽に対し黄経補正をします。  
元期 Epoch が年で与えられている場合は、以下の式を用います

$loncorr = 3.82394E-5 \times (365.2422 \times ( Epoch - 2000.0) -d$

現代の日付で計算する場合、補正は不要です。

## 月の摂動

月の座標を2度以下の精度で計算したい場合、摂動を考慮する必要があります。  
2度未満の誤差が必要な場合は、以下のすべての項を考慮する必要があります。  
そこまでの精度が必要ない場合は、影響の少ない項目を除外しても構いません。  

まず、以下の項目を計算します。

Ms, Mm
: 太陽および月の平均近点角

Nm
: 月の昇交点経度

ws, wm
: 太陽および月の近点引数

$Ls = Ms + ws$
: 太陽の平均黄経（Ns = 0）

$Lm = Mm + wm + Nm$
: 月の平均黄経

$D = Lm - Ls$
: 太陽と月の離角

$F = Lm - Nm$
: 月の緯度引数

以下の項を月の黄経に加算します（度数法）

$-1.274 \times sin(Mm - 2 \times D)$ (出差)  
$+0.658 \times sin(2 \times D)$ (変動)  
$-0.186 \times sin(Ms)$ (the Yearly Equation)  
$-0.059 \times sin(2 \times Mm - 2 \times D)$  
$-0.057 \times sin(Mm - 2\ times D + Ms)$  
$+0.053 \times sin(Mm + 2 \times D)$  
$+0.046 \times sin(2 \times D - Ms)$  
$+0.041 \times sin(Mm - Ms)$  
$-0.035 \times sin(D)$ (the Parallactic Equation)  
$-0.031 \times sin(Mm + Ms)$  
$-0.015 \times sin(2 \times F - 2 \times D)$  
$+0.011 \times sin(Mm - 4 \times D)$

以下の項を月の黄緯に加算します（度数法）

$-0.173 \times sin(F - 2 \times D)$
$-0.055 \times sin(Mm - F - 2 \times D)$
$-0.046 \times sin(Mm + F - 2 \times D)$
$+0.033 \times sin(F + 2 \times D)$
$+0.017 \times sin(2 \times Mm + F)$

以下の項を月までの距離に加算します（地球の半径の倍数）

$-0.58 \times cos(Mm - 2 \times D)$
$-0.46 \times cos(2 \times D)$

黄経・黄緯に対する影響が0.01度未満の項、および月までの距離に対する影響が0.1地球半径未満の項は除外しています。

## 木星、土星および天王星の摂動

0.01度以上の摂動がある惑星は、、木星、土星、天王星の3惑星のみです。  
まず以下を計算します

Mj
: 木星の平均近点角

Ms
: 土星の平均近点角

Mu
: 天王星の平均近点角

木星の場合、摂動の補正のために、黄経に以下の項を加算してください

$-0.332 \times sin(2 \times Mj - 5 \times Ms - 67.6°)$  
$-0.056 \times sin(2 \times Mj - 2 \times Ms + 21°)$  
$+0.042 \times sin(3 \times Mj - 5 \times Ms + 21°)$  
$-0.036 \times sin(Mj - 2 \times Ms)$  
$+0.022 \times cos(Mj - Ms)$  
$+0.023 \times sin(2 \times Mj - 3 \times Ms + 52°)$  
$-0.016 \times sin(Mj - 5 \times Ms - 69°)$  

土星の場合、摂動の補正のために、黄経に以下の項を加算してください

$+0.812 \times sin(2 \times Mj - 5 \times Ms - 67.6°)$  
$-0.229 \times cos(2 \times Mj - 4 \times Ms - 2°)$  
$+0.119 \times sin(Mj - 2 \times Ms - 3°)$  
$+0.046 \times sin(2 \times Mj - 6 \times Ms - 69°)$  
$+0.014 \times sin(Mj - 3 \times Ms + 32°)$  

天王星の場合、摂動の補正のために、黄経に以下の項を加算してください

$+0.040 \times sin(Ms - 2 \times Mu + 6°)$  
$+0.035 \times sin(Ms - 3 \times Mu + 33°)$  
$-0.015 \times sin(Mj - Mu + 20°)$  

木星と土星が相互に関係する項は、木星と土星にとって最も大きな摂動の要因です。周期は918年におよび、その大きさは木星で0.332度、土星で0.812度に及びます。  
また、土星と天王星の相互に関係する項は、周期560年で天王星に0.035度、土星に0.01度未満の影響を与えます（なので土星の摂動の項からは除外しています）。
その他の摂動の項は14年から100年の周期です。冥王星-海王星間の摂動の項は4220年周期と非常に周期が長く、その影響も1度程度のため含んでいません。

水星、金星および火星についてはすべての要因を無視できます。海王星に関しては重要な項のみ軌道要素に含んでいます。  

## 冥王星の座標

冥王星は解析的理論が有りません。なのでここでは数値積分として表現します。  
おそらく1800年～2100年の期間ではよく当てはまります。  

まず、以下を計算します。

$S  =   50.03  +  0.033459652 \times d$
$P  =  238.95  +  0.003968789 \times d$

上記を使って、地心黄道座標を計算します。

$lonecl = 238.9508  +  0.00400703 \times d$  
$- 19.799 \times sin(P)     + 19.848 \times cos(P)$  
$+ 0.897 \times sin(2 \times P)    - 4.956 \times cos(2 \times P)$  
$+ 0.610 \times sin(3 \times P)    + 1.211 \times cos(3 \times P )$  
$- 0.341 \times sin(4 \times P)    - 0.190 \times cos(4 \times P)$  
$+ 0.128 \times sin(5 \times P)    - 0.034 \times cos(5 \times P)$  
$- 0.038 \times sin(6 \times P)    + 0.031 \times cos(6 \times P)$  
$+ 0.020 \times sin(S-P)    - 0.010 \times cos(S-P)$  

$latecl =  -3.9082$
$- 5.453 \times sin(P)     - 14.975 \times cos(P)$  
$+ 3.527 \times sin(2 \times P)    + 1.673 \times cos(2 \times P)$  
$- 1.051 \times sin(3 \times P)    + 0.328 \times cos(3 \times P)$  
$+ 0.179 \times sin(4 \times P)    - 0.292 \times cos(4 \times P)$  
$+ 0.019 \times sin(5 \times P)    + 0.100 \times cos(5 \times P)$  
$- 0.031 \times sin(6 \times P)    - 0.026 \times cos(6 \times P)$  
$+ 0.011 \times cos(S-P)$

$r =  40.72$
$+ 6.68 \times sin(P)       + 6.90 \times cos(P)$
$- 1.18 \times sin(2 \times P) - 0.03 \times cos(2 \times P)$
$+ 0.15 \times sin(3 \times P) - 0.14 \times cos(3 \times P)$
